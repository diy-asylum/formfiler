task('npm_install', type:Exec) {
    inputs.files(project.fileTree(dir: "."))
    outputs.dir("${project.buildDir}/node_modules/")
    commandLine 'npm', 'install'
}

task('npm_clean', type:Exec) {
    def node_modules_directory = "${project.buildDir}/node_modules/"
    def node_modules = new File(node_modules_directory)

    if( node_modules.exists() ) {
        commandLine 'rm', '-r', node_modules_directory
    } else {
        commandLine 'echo', 'No node modules to clean'
    }
}

task('npm_test', type:Exec) {
    dependsOn 'npm_install'
    environment "CI", "true"
    commandLine 'npm', 'test'
}

test.dependsOn(':diy_asylum_frontend:npm_test')
clean.dependsOn(':diy_asylum_frontend:npm_clean')
